var H=Object.create;var h=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols,Q=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var j=(e,t,n)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t)=>{for(var n in t||(t={}))S.call(t,n)&&j(e,n,t[n]);if(E)for(var n of E(t))W.call(t,n)&&j(e,n,t[n]);return e};var v=e=>h(e,"__esModule",{value:!0});var K=(e,t)=>{for(var n in t)h(e,n,{get:t[n],enumerable:!0})},B=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of M(t))!S.call(e,i)&&(n||i!=="default")&&h(e,i,{get:()=>t[i],enumerable:!(o=J(t,i))||o.enumerable});return e},A=(e,t)=>B(v(h(e!=null?H(Q(e)):{},"default",!t&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),X=(e=>(t,n)=>e&&e.get(t)||(n=B(v({}),t,1),e&&e.set(t,n),n))(typeof WeakMap!="undefined"?new WeakMap:0);var te={};K(te,{releaseBump:()=>ee});var Y="3.0.0-alpha.41",w={RELEASE_BUMP_VERSION:Y};var T=require("console"),F=require("fs"),c=require("fs/promises"),I=require("path");function L(e,t){return e.filter(n=>!t.some(o=>n.includes(o)))}function q(e){let t=[];return e.forEach(n=>{Array.isArray(n)?t.push(...q(n)):t.push(n)}),t}function _(e){if(typeof e=="string"){if(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()!@:%_+.~#?&/=]*)/.test(e))return e;if(/^[-a-zA-Z0-9()!@:%_+~#?&=]+\/[-a-zA-Z0-9()!@:%_+~#?&=]+$/.test(e))return`https://github.com/${e}`}else return typeof(e==null?void 0:e.url)>"u"?"":_(e.url.replace(/(^git\+|\.git$)/,""));return""}async function U(e,t){var m,P;let{date:n,isChangelog:o,prefix:i,release:a,repository:r}=t;if(!/^\d+\.\d+\.\d+$/.test(a))return e;let l=(P=(m=/\d+\.\d+\.\d+/.exec(a))==null?void 0:m[0])!=null?P:a;if(o===!1)return e.replace(/@([Ss]ince|[Vv]ersion)(:?\s+)unreleased/g,`@$1$2${l}`);let u=r.includes("bitbucket.org")?"bitbucket":"github",y=`${r}/${u==="bitbucket"?"commits":"releases"}/tag/${i?"v":""}${l}`,p=`## [${i?"v":""}${l}]`+(r!==""?`(${y})`:"")+(n?` - ${n}`:"");if(e.includes(p))return e;let $=`(${r}/${u==="bitbucket"?"branches/":""}compare/HEAD..${i?"v":""}${l})`,d=`## [Unreleased]${r?$:""}

### `+["Added","Changed","Deprecated","Removed","Fixed","Security"].join(`

### `);return e.replace(/## \[Unreleased\](\(.*\))?/,p).replace(/### (Added|Changed|Deprecated|Removed|Fixed|Security)\n\n/g,"").replace(/### (Added|Changed|Deprecated|Removed|Fixed|Security)\n$/g,"").replace(/\n\n$/g,`
`).replace(p,d+`

`+p)}async function N(e){var i,a;let t=e!=null?e:"release-bump.config.js";switch((i=["js","mjs","cjs","json"].find(r=>t.indexOf(`.${r}`)===t.length-`.${r}`.length))!=null?i:""){case"js":case"mjs":case"cjs":{let r=await Promise.resolve().then(()=>A(require(t))).catch(()=>({}));if(typeof r=="function"){let s=await r();if(typeof s!="object"||Object.keys(s).length<1)break;return s}else if(typeof r.default=="function"){let s=await r.default();if(typeof s!="object"||Object.keys(s).length<1)break;return s}if(Object.keys(r).length>0)return(a=r.default)!=null?a:r;break}case"json":try{return JSON.parse(await(0,c.readFile)(t,"utf8"))}catch(r){}break;default:break}return{}}async function k(e){let{directoriesToIgnore:t,failOnError:n,filesPath:o,paths:i}=e;if(t.some(s=>o.includes(s)))return i!=null?i:[];let a=[];try{a=await(0,c.readdir)(o)}catch(s){if(n)throw process.exitCode=1,s;a=[]}let r=await Promise.all(a.map(async s=>(await(0,c.stat)(`${o}/${s}`)).isDirectory()===!0?await k({directoriesToIgnore:t,failOnError:n,filesPath:`${o}/${s}`,paths:i}):(0,I.join)(`${o}/${s}`)));return[...new Set(q([...i,...r]))]}function z({quiet:e}){return e===!0?new T.Console({stdout:(0,F.createWriteStream)("/dev/null"),stderr:(0,F.createWriteStream)("/dev/null")}):console}async function V(e){var r;let t,n=w.NODE_ENV==="test"||!1;try{t=JSON.parse(await(0,c.readFile)("package.json","utf8"))}catch(s){t={repository:"",version:"0.0.0"}}let o=[".git",".github","coverage","dist","node_modules","tests/fixtures"],i={changelogPath:"CHANGELOG.md",configFilePath:"release-bump.config.js",date:(r=new Date().toISOString().split("T"))==null?void 0:r[0],dryRun:!1,failOnError:!1,filesPath:".",ignore:o,prefix:!1,quiet:n,release:t.version,repository:_(t.repository)};return f(f({},i),e)}var O=require("fs/promises");async function ee(e){let t=await V(e),n=await N(t.configFilePath),{changelogPath:o,date:i,dryRun:a,failOnError:r,filesPath:s,ignore:l,prefix:u,quiet:y,release:p,repository:$}=f(f({},n),t),d=z({quiet:y}),m=l,Z=await k({directoriesToIgnore:m,failOnError:r,filesPath:s,paths:[o]}),G=L(Z,m),b=[];return await Promise.all(G.map(async g=>{let R="";try{R=await(0,O.readFile)(g,"utf8")}catch(x){if(r)throw process.exitCode=1,x;d.warn(`could not read ${g}`)}let C=await U(R,{date:i,isChangelog:o===g,prefix:u,quiet:y,release:p,repository:$});if(R!==C&&(b.push(g),!a))try{await(0,O.writeFile)(g,C,"utf8")}catch(x){if(r)throw process.exitCode=1,x;d.warn(`could not write ${g}`,x)}})),b.length>0&&d.info((a?"would have ":"")+`bumped ${b.join(", ")}`),b}module.exports=X(te);0&&(module.exports={releaseBump});
